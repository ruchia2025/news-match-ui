<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ‹ãƒ¥ãƒ¼ã‚¹é–¢é€£æ¤œç´¢</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    textarea {
      width: 100%;
    }
    #result {
      margin-top: 20px;
    }
    pre {
      background-color: #f0f0f0;
      padding: 10px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h2>æ—¥è¨˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
  <textarea id="diary" rows="5" cols="40" placeholder="ä¾‹ï¼šæœ€è¿‘ãŠç±³ãŒé«˜ãã¦è²·ã†ã®ã‚’ã‚„ã‚ã¾ã—ãŸã€‚"></textarea>
  <br />
  <button onclick="searchNews()">é–¢é€£ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¦‹ã‚‹</button>

  <div id="result"></div>

  <script>
    async function searchNews() {
      const text = document.getElementById('diary').value;
      const resultDiv = document.getElementById('result');

      if (!text.trim()) {
        resultDiv.innerHTML = 'âš ï¸ å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
        return;
      }

      resultDiv.innerHTML = 'ğŸ” æ¤œç´¢ä¸­...';

      const url = 'https://news-match-api.maisugimoto2003.workers.dev/api/nearest-news?text=' + encodeURIComponent(text);
      console.log("ğŸ“¡ ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å…ˆ:", url);

      try {
        const response = await fetch(url);

        console.log("ğŸ“¨ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:", response.status, response.statusText);

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTPã‚¨ãƒ©ãƒ¼ ${response.status}: ${response.statusText}\n${errorText}`);
        }

        const data = await response.json();
        console.log("âœ… å—ä¿¡ãƒ‡ãƒ¼ã‚¿:", data);

        resultDiv.innerHTML = '';

        if (!data.matches || data.matches.length === 0) {
          resultDiv.textContent = 'ğŸ“­ é–¢é€£ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚';
          return;
        }

        resultDiv.innerHTML = '<h3>ğŸ“° é–¢é€£ãƒ‹ãƒ¥ãƒ¼ã‚¹:</h3>';
        data.matches.forEach(item => {
          const div = document.createElement('div');
          div.innerHTML = `<strong>${item.title}</strong><br><p>${item.body.slice(0, 100)}...</p><hr/>`;
          resultDiv.appendChild(div);
        });

      } catch (error) {
        console.error("âŒ ã‚¨ãƒ©ãƒ¼å†…å®¹:", error);
        resultDiv.innerHTML = `<p>âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p><pre>${error.message}</pre>`;
      }
    }
  </script>
</body>
</html>
